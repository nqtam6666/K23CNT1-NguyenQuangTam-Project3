<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{admin/layout :: layout(nqtTitle='Cấu hình Website')}">

<body>
    <div th:fragment="content">
        <div class="flex items-center justify-between mb-6 border-b pb-4">
            <h1 class="text-2xl font-semibold text-gray-800">Cấu hình Website</h1>
        </div>

        <!-- Navigation Tabs -->
        <div class="bg-gray-700 rounded-lg p-2 mb-6">
            <div class="flex flex-wrap gap-2">
                <button type="button" onclick="showTab('general')" id="tab-general"
                    class="px-4 py-2 rounded-md font-medium transition-all bg-white text-gray-800 shadow-sm">
                    THÔNG TIN CHUNG
                </button>
                <button type="button" onclick="showTab('smtp')" id="tab-smtp"
                    class="px-4 py-2 rounded-md font-medium transition-all text-white hover:bg-gray-600">
                    SMTP EMAIL
                </button>
                <button type="button" onclick="showTab('vip')" id="tab-vip"
                    class="px-4 py-2 rounded-md font-medium transition-all text-white hover:bg-gray-600">
                    CHIẾT KHẤU VIP
                </button>
                <button type="button" onclick="showTab('support')" id="tab-support"
                    class="px-4 py-2 rounded-md font-medium transition-all text-white hover:bg-gray-600">
                    LINK HỖ TRỢ
                </button>
                <button type="button" onclick="showTab('ratelimit')" id="tab-ratelimit"
                    class="px-4 py-2 rounded-md font-medium transition-all text-white hover:bg-gray-600">
                    RATE LIMITING & BRUTE FORCE
                </button>
                <button type="button" onclick="showTab('security')" id="tab-security"
                    class="px-4 py-2 rounded-md font-medium transition-all text-white hover:bg-gray-600">
                    BẢO MẬT
                </button>
                <button type="button" onclick="showTab('banner')" id="tab-banner"
                    class="px-4 py-2 rounded-md font-medium transition-all text-white hover:bg-gray-600">
                    BANNER
                </button>
            </div>
        </div>

        <form th:action="${nqtAdminPath} + '/setting'" method="post" enctype="multipart/form-data" autocomplete="off"
            class="bg-white shadow-md rounded-lg p-6 max-w-4xl">
            <!-- Hidden fields to prevent browser autocomplete -->
            <input type="text" style="position: absolute; left: -9999px;" tabindex="-1" autocomplete="chrome-off">
            <input type="email" style="position: absolute; left: -9999px;" tabindex="-1" autocomplete="chrome-off">
            <input type="password" style="position: absolute; left: -9999px;" tabindex="-1" autocomplete="new-password">
            
            <!-- Tab: THÔNG TIN CHUNG -->
            <div id="content-general" class="tab-content">
                <div class="mb-4">
                    <label for="nqtWebsiteName" class="block text-sm font-medium text-gray-700 mb-1">Tên Website</label>
                    <input type="text" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtWebsiteName" name="nqtWebsiteName" th:value="${nqtWebsiteName}">
                </div>
                <div class="mb-4">
                    <label for="nqtTieuDe" class="block text-sm font-medium text-gray-700 mb-1">Tiêu đề</label>
                    <input type="text" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtTieuDe" name="nqtTieuDe" th:value="${nqtTieuDe}">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Logo Website</label>
                    <div class="flex items-center space-x-4">
                        <div th:if="${nqtWebsiteLogo != null && nqtWebsiteLogo != ''}"
                            class="w-16 h-16 border rounded p-1 flex items-center justify-center">
                            <img th:src="${nqtWebsiteLogo}" alt="Logo" class="max-w-full max-h-full object-contain">
                        </div>
                        <input type="file" name="nqtWebsiteLogoFile" accept="image/*" autocomplete="chrome-off"
                            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    </div>
                </div>
                <div class="mb-6">
                    <label for="nqtWebsiteColor" class="block text-sm font-medium text-gray-700 mb-1">Màu chủ đạo</label>
                    <div class="flex items-center space-x-2">
                        <input type="color" autocomplete="chrome-off" class="h-10 w-20 p-1 border border-gray-300 rounded cursor-pointer"
                            id="nqtWebsiteColor" name="nqtWebsiteColor" th:value="${nqtWebsiteColor}"
                            title="Chọn màu chủ đạo">
                        <span class="text-sm text-gray-500">Chọn màu sắc cho thanh bên và các điểm nhấn</span>
                    </div>
                </div>
                <div class="mb-6">
                    <label for="nqtWebsiteFont" class="block text-sm font-medium text-gray-700 mb-1">Font chữ</label>
                    <select id="nqtWebsiteFont" name="nqtWebsiteFont" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
                        <option value="Nunito" th:selected="${nqtWebsiteFont == 'Nunito'}">Nunito (Mặc định)</option>
                        <option value="Roboto" th:selected="${nqtWebsiteFont == 'Roboto'}">Roboto</option>
                        <option value="Open Sans" th:selected="${nqtWebsiteFont == 'Open Sans'}">Open Sans</option>
                        <option value="Montserrat" th:selected="${nqtWebsiteFont == 'Montserrat'}">Montserrat</option>
                        <option value="Inter" th:selected="${nqtWebsiteFont == 'Inter'}">Inter</option>
                        <option value="Poppins" th:selected="${nqtWebsiteFont == 'Poppins'}">Poppins</option>
                        <option value="Lato" th:selected="${nqtWebsiteFont == 'Lato'}">Lato</option>
                        <option value="Raleway" th:selected="${nqtWebsiteFont == 'Raleway'}">Raleway</option>
                        <option value="Ubuntu" th:selected="${nqtWebsiteFont == 'Ubuntu'}">Ubuntu</option>
                        <option value="Playfair Display" th:selected="${nqtWebsiteFont == 'Playfair Display'}">Playfair
                            Display (Serif)</option>
                        <option value="Lora" th:selected="${nqtWebsiteFont == 'Lora'}">Lora (Serif)</option>
                        <option value="Merriweather" th:selected="${nqtWebsiteFont == 'Merriweather'}">Merriweather (Serif)
                        </option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500">Font chữ cho trang Admin</p>
                </div>
                
                <!-- Customer Font Settings -->
                <div class="mb-6 border-t pt-4">
                    <h4 class="text-md font-semibold text-gray-700 mb-3">Font chữ Trang Khách</h4>
                    
                    <div class="mb-4">
                        <label for="nqtCustomerFontBody" class="block text-sm font-medium text-gray-700 mb-1">
                            Font chữ Body (Nội dung chính)
                        </label>
                        <select id="nqtCustomerFontBody" name="nqtCustomerFontBody" autocomplete="chrome-off"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
                            <option value="" th:selected="${nqtCustomerFontBody == null or nqtCustomerFontBody == ''}">Dùng font Admin (Mặc định)</option>
                            <option value="Inter" th:selected="${nqtCustomerFontBody == 'Inter'}">Inter</option>
                            <option value="Roboto" th:selected="${nqtCustomerFontBody == 'Roboto'}">Roboto</option>
                            <option value="Open Sans" th:selected="${nqtCustomerFontBody == 'Open Sans'}">Open Sans</option>
                            <option value="Montserrat" th:selected="${nqtCustomerFontBody == 'Montserrat'}">Montserrat</option>
                            <option value="Poppins" th:selected="${nqtCustomerFontBody == 'Poppins'}">Poppins</option>
                            <option value="Lato" th:selected="${nqtCustomerFontBody == 'Lato'}">Lato</option>
                            <option value="Raleway" th:selected="${nqtCustomerFontBody == 'Raleway'}">Raleway</option>
                            <option value="Ubuntu" th:selected="${nqtCustomerFontBody == 'Ubuntu'}">Ubuntu</option>
                            <option value="Nunito" th:selected="${nqtCustomerFontBody == 'Nunito'}">Nunito</option>
                        </select>
                        <p class="mt-1 text-xs text-gray-500">Font chữ cho nội dung chính, đoạn văn, mô tả trên trang khách</p>
                    </div>
                    
                    <div class="mb-4">
                        <label for="nqtCustomerFontHeading" class="block text-sm font-medium text-gray-700 mb-1">
                            Font chữ Heading (Tiêu đề)
                        </label>
                        <select id="nqtCustomerFontHeading" name="nqtCustomerFontHeading" autocomplete="chrome-off"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
                            <option value="Playfair Display" th:selected="${nqtCustomerFontHeading == 'Playfair Display'}">Playfair Display (Mặc định)</option>
                            <option value="Lora" th:selected="${nqtCustomerFontHeading == 'Lora'}">Lora</option>
                            <option value="Merriweather" th:selected="${nqtCustomerFontHeading == 'Merriweather'}">Merriweather</option>
                            <option value="Cormorant Garamond" th:selected="${nqtCustomerFontHeading == 'Cormorant Garamond'}">Cormorant Garamond</option>
                            <option value="Cinzel" th:selected="${nqtCustomerFontHeading == 'Cinzel'}">Cinzel</option>
                            <option value="Inter" th:selected="${nqtCustomerFontHeading == 'Inter'}">Inter</option>
                            <option value="Montserrat" th:selected="${nqtCustomerFontHeading == 'Montserrat'}">Montserrat</option>
                            <option value="Poppins" th:selected="${nqtCustomerFontHeading == 'Poppins'}">Poppins</option>
                            <option value="Roboto" th:selected="${nqtCustomerFontHeading == 'Roboto'}">Roboto</option>
                        </select>
                        <p class="mt-1 text-xs text-gray-500">Font chữ cho các tiêu đề (h1, h2, h3...) trên trang khách</p>
                    </div>
                    
                    <div class="mb-4">
                        <label for="nqtCustomerFontSerif" class="block text-sm font-medium text-gray-700 mb-1">
                            Font chữ Serif (Đặc biệt)
                        </label>
                        <select id="nqtCustomerFontSerif" name="nqtCustomerFontSerif" autocomplete="chrome-off"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all">
                            <option value="Playfair Display" th:selected="${nqtCustomerFontSerif == 'Playfair Display'}">Playfair Display (Mặc định)</option>
                            <option value="Lora" th:selected="${nqtCustomerFontSerif == 'Lora'}">Lora</option>
                            <option value="Merriweather" th:selected="${nqtCustomerFontSerif == 'Merriweather'}">Merriweather</option>
                            <option value="Cormorant Garamond" th:selected="${nqtCustomerFontSerif == 'Cormorant Garamond'}">Cormorant Garamond</option>
                            <option value="Cinzel" th:selected="${nqtCustomerFontSerif == 'Cinzel'}">Cinzel</option>
                            <option value="PT Serif" th:selected="${nqtCustomerFontSerif == 'PT Serif'}">PT Serif</option>
                        </select>
                        <p class="mt-1 text-xs text-gray-500">Font chữ serif cho các phần đặc biệt, highlight trên trang khách</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label for="nqtWebsiteAddress" class="block text-sm font-medium text-gray-700 mb-1">Địa chỉ</label>
                    <input type="text" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtWebsiteAddress" name="nqtWebsiteAddress" th:value="${nqtWebsiteAddress}">
                </div>
                <div class="mb-4">
                    <label for="nqtWebsitePhone" class="block text-sm font-medium text-gray-700 mb-1">Số điện thoại</label>
                    <input type="text" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtWebsitePhone" name="nqtWebsitePhone" th:value="${nqtWebsitePhone}">
                </div>
                <div class="mb-4">
                    <label for="nqtWebsiteEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtWebsiteEmail" name="nqtWebsiteEmail" th:value="${nqtWebsiteEmail}">
                </div>
                <div class="mb-4">
                    <label for="nqtWebsiteFacebook" class="block text-sm font-medium text-gray-700 mb-1">Link Facebook</label>
                    <input type="url" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtWebsiteFacebook" name="nqtWebsiteFacebook" th:value="${nqtWebsiteFacebook}" placeholder="https://facebook.com/...">
                </div>
                <div class="mb-4">
                    <label for="nqtWebsiteZalo" class="block text-sm font-medium text-gray-700 mb-1">Link Zalo</label>
                    <input type="url" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtWebsiteZalo" name="nqtWebsiteZalo" th:value="${nqtWebsiteZalo}" placeholder="https://zalo.me/...">
                </div>
                <div class="mb-4">
                    <label for="nqtWebsiteLink" class="block text-sm font-medium text-gray-700 mb-1">Link Website</label>
                    <input type="url" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtWebsiteLink" name="nqtWebsiteLink" th:value="${nqtWebsiteLink}" placeholder="https://...">
                </div>
                <div class="mb-4">
                    <label for="nqtWebsiteFAQ" class="block text-sm font-medium text-gray-700 mb-1">Link FAQ</label>
                    <input type="url" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtWebsiteFAQ" name="nqtWebsiteFAQ" th:value="${nqtWebsiteFAQ}" placeholder="https://... hoặc /faq">
                </div>
            </div>

            <!-- Tab: SMTP EMAIL -->
            <div id="content-smtp" class="tab-content hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Cấu hình SMTP Email (Gmail)</h3>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <p class="text-sm text-blue-800 mb-2"><strong>Hướng dẫn cấu hình Gmail:</strong></p>
                    <ol class="list-decimal list-inside text-sm text-blue-700 space-y-1">
                        <li>Truy cập <a href="https://myaccount.google.com/apppasswords" target="_blank" class="underline">Google App Passwords</a></li>
                        <li>Tạo App Password mới (nếu chưa bật 2-Step Verification, cần bật trước)</li>
                        <li>Sử dụng App Password (16 ký tự) thay vì mật khẩu Gmail thông thường</li>
                        <li>Điền thông tin bên dưới và nhấn "Lưu cấu hình"</li>
                    </ol>
                </div>

                <div class="mb-4">
                    <label for="nqtSmtpHost" class="block text-sm font-medium text-gray-700 mb-1">SMTP Host</label>
                    <input type="text" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtSmtpHost" name="nqtSmtpHost" th:value="${nqtSmtpHost ?: 'smtp.gmail.com'}" placeholder="smtp.gmail.com">
                    <p class="mt-1 text-xs text-gray-500">Gmail: smtp.gmail.com</p>
                </div>

                <div class="mb-4">
                    <label for="nqtSmtpPort" class="block text-sm font-medium text-gray-700 mb-1">SMTP Port</label>
                    <input type="number" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtSmtpPort" name="nqtSmtpPort" th:value="${nqtSmtpPort ?: '587'}" placeholder="587">
                    <p class="mt-1 text-xs text-gray-500">Gmail: 587 (TLS) hoặc 465 (SSL)</p>
                </div>

                <div class="mb-4">
                    <label for="nqtSmtpUsername" class="block text-sm font-medium text-gray-700 mb-1">Email (Username)</label>
                    <input type="email" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtSmtpUsername" name="nqtSmtpUsername" th:value="${nqtSmtpUsername}" placeholder="your-email@gmail.com">
                    <p class="mt-1 text-xs text-gray-500">Địa chỉ email Gmail của bạn</p>
                </div>

                <div class="mb-4">
                    <label for="nqtSmtpPassword" class="block text-sm font-medium text-gray-700 mb-1">App Password</label>
                    <input type="password" autocomplete="new-password"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtSmtpPassword" name="nqtSmtpPassword" placeholder="Nhập App Password (16 ký tự)">
                    <p class="mt-1 text-xs text-gray-500">App Password từ Google (không phải mật khẩu Gmail thông thường). Để trống nếu không muốn thay đổi.</p>
                </div>

                <div class="mb-4">
                    <label for="nqtSmtpFromEmail" class="block text-sm font-medium text-gray-700 mb-1">Email gửi đi (From Email)</label>
                    <input type="email" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtSmtpFromEmail" name="nqtSmtpFromEmail" th:value="${nqtSmtpFromEmail}" placeholder="your-email@gmail.com">
                    <p class="mt-1 text-xs text-gray-500">Email sẽ hiển thị trong phần "From" của email gửi đi</p>
                </div>

                <div class="mb-4">
                    <label for="nqtSmtpFromName" class="block text-sm font-medium text-gray-700 mb-1">Tên người gửi (From Name)</label>
                    <input type="text" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        id="nqtSmtpFromName" name="nqtSmtpFromName" th:value="${nqtSmtpFromName}" placeholder="Hotel NQT">
                    <p class="mt-1 text-xs text-gray-500">Tên sẽ hiển thị trong phần "From" của email gửi đi</p>
                </div>

                <div class="mb-4">
                    <button type="button" onclick="testSmtpConnection()"
                        class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg shadow-sm transition-colors">
                        <i class="bi bi-envelope-check mr-2"></i> Test kết nối SMTP
                    </button>
                    <div id="smtpTestResult" class="mt-2 hidden"></div>
                </div>
            </div>

            <!-- Tab: CHIẾT KHẤU VIP -->
            <div id="content-vip" class="tab-content hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Chiết khấu Khách VIP</h3>
                <div class="mb-4">
                    <label for="nqtVipDiscountPercent" class="block text-sm font-medium text-gray-700 mb-1">
                        Phần trăm chiết khấu mặc định cho khách VIP (%)
                    </label>
                    <div class="flex items-center space-x-2">
                        <input type="number" autocomplete="chrome-off"
                            min="0" 
                            max="100" 
                            step="0.1"
                            class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                            id="nqtVipDiscountPercent" 
                            name="nqtVipDiscountPercent" 
                            th:value="${nqtVipDiscountPercent ?: '10'}"
                            placeholder="10">
                        <span class="text-sm text-gray-500">% (0-100)</span>
                    </div>
                    <p class="mt-1 text-xs text-gray-500">
                        Chiết khấu này sẽ tự động áp dụng cho tất cả khách hàng có cấp bậc VIP khi đặt phòng (nếu không sử dụng mã giảm giá khác).
                    </p>
                </div>
            </div>

            <!-- Tab: LINK HỖ TRỢ -->
            <div id="content-support" class="tab-content hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Các link hỗ trợ</h3>
                <div class="mb-6">
                    <label for="nqtWebsiteSupportLinks" class="block text-sm font-medium text-gray-700 mb-1">Các link hỗ trợ (mỗi dòng một link, format: Tên|URL|Nội dung HTML)</label>
                    <textarea id="nqtWebsiteSupportLinks" name="nqtWebsiteSupportLinks" rows="8" autocomplete="chrome-off"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all font-mono text-sm"
                        placeholder="Chính sách hủy|/nqtSupport/chinh-sach-huy|&lt;p&gt;Nội dung HTML ở đây...&lt;/p&gt;&#10;Điều khoản sử dụng|/nqtSupport/dieu-khoan|&lt;p&gt;Nội dung HTML...&lt;/p&gt;"><th:block th:if="${nqtWebsiteSupportLinks != null and nqtWebsiteSupportLinks != ''}" th:inline="text">[[${nqtWebsiteSupportLinks}]]</th:block></textarea>
                    <div class="text-xs text-gray-500 mt-2 space-y-1">
                        <p><strong>Format:</strong> Tên|URL|Nội dung HTML</p>
                        <p><strong>Ví dụ:</strong></p>
                        <pre class="bg-gray-50 p-2 rounded text-xs overflow-x-auto">Chính sách hủy|/nqtSupport/chinh-sach-huy|&lt;h2&gt;Chính sách hủy&lt;/h2&gt;&lt;p&gt;Khách hàng có thể hủy đặt phòng trước 24 giờ...&lt;/p&gt;
Điều khoản sử dụng|/nqtSupport/dieu-khoan|&lt;h2&gt;Điều khoản&lt;/h2&gt;&lt;p&gt;Nội dung điều khoản...&lt;/p&gt;</pre>
                        <p class="mt-2"><strong>Lưu ý:</strong> URL sẽ tự động tạo route /nqtSupport/{slug}. Nếu không có nội dung HTML, sẽ hiển thị nội dung mặc định.</p>
                    </div>
                </div>
            </div>

            <!-- Tab: RATE LIMITING & BRUTE FORCE -->
            <div id="content-ratelimit" class="tab-content hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Cấu hình Rate Limiting & Brute Force Protection</h3>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-yellow-800"><strong>Lưu ý:</strong> Các cài đặt này giúp bảo vệ hệ thống khỏi các cuộc tấn công brute force và rate limiting. Thay đổi các giá trị này có thể ảnh hưởng đến trải nghiệm người dùng.</p>
                </div>

                <div class="mb-6 border-b pb-4">
                    <h4 class="text-md font-semibold text-gray-700 mb-3">Brute Force Protection (Bảo vệ chống tấn công brute force)</h4>
                    
                    <div class="mb-4">
                        <label for="rate_limit_max_failed_attempts" class="block text-sm font-medium text-gray-700 mb-1">
                            Số lần đăng nhập sai tối đa trước khi khóa tài khoản
                        </label>
                        <div class="flex items-center space-x-2">
                            <input type="number" autocomplete="chrome-off"
                                min="3" 
                                max="20" 
                                step="1"
                                class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                                id="rate_limit_max_failed_attempts" 
                                name="rate_limit_max_failed_attempts" 
                                th:value="${rate_limit_max_failed_attempts ?: '5'}"
                                placeholder="5">
                            <span class="text-sm text-gray-500">lần (3-20)</span>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                            Sau khi đăng nhập sai số lần này, tài khoản sẽ bị khóa tạm thời.
                        </p>
                    </div>

                    <div class="mb-4">
                        <label for="rate_limit_lockout_duration_minutes" class="block text-sm font-medium text-gray-700 mb-1">
                            Thời gian khóa tài khoản (phút)
                        </label>
                        <div class="flex items-center space-x-2">
                            <input type="number" autocomplete="chrome-off"
                                min="5" 
                                max="1440" 
                                step="1"
                                class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                                id="rate_limit_lockout_duration_minutes" 
                                name="rate_limit_lockout_duration_minutes" 
                                th:value="${rate_limit_lockout_duration_minutes ?: '15'}"
                                placeholder="15">
                            <span class="text-sm text-gray-500">phút (5-1440)</span>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                            Thời gian tài khoản bị khóa sau khi vượt quá số lần đăng nhập sai.
                        </p>
                    </div>
                </div>

                <div class="mb-6 border-b pb-4">
                    <h4 class="text-md font-semibold text-gray-700 mb-3">Rate Limiting theo Tài khoản/Email</h4>
                    
                    <div class="mb-4">
                        <label for="rate_limit_max_attempts" class="block text-sm font-medium text-gray-700 mb-1">
                            Số lần thử đăng nhập tối đa trong khoảng thời gian
                        </label>
                        <div class="flex items-center space-x-2">
                            <input type="number" autocomplete="chrome-off"
                                min="5" 
                                max="50" 
                                step="1"
                                class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                                id="rate_limit_max_attempts" 
                                name="rate_limit_max_attempts" 
                                th:value="${rate_limit_max_attempts ?: '10'}"
                                placeholder="10">
                            <span class="text-sm text-gray-500">lần (5-50)</span>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                            Giới hạn số lần thử đăng nhập cho mỗi tài khoản/email trong khoảng thời gian.
                        </p>
                    </div>

                    <div class="mb-4">
                        <label for="rate_limit_window_minutes" class="block text-sm font-medium text-gray-700 mb-1">
                            Khoảng thời gian (phút)
                        </label>
                        <div class="flex items-center space-x-2">
                            <input type="number" autocomplete="chrome-off"
                                min="1" 
                                max="60" 
                                step="1"
                                class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                                id="rate_limit_window_minutes" 
                                name="rate_limit_window_minutes" 
                                th:value="${rate_limit_window_minutes ?: '15'}"
                                placeholder="15">
                            <span class="text-sm text-gray-500">phút (1-60)</span>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                            Khoảng thời gian tính số lần thử đăng nhập.
                        </p>
                    </div>
                </div>

                <div class="mb-6 border-b pb-4">
                    <h4 class="text-md font-semibold text-gray-700 mb-3">Rate Limiting theo Địa chỉ IP</h4>
                    
                    <div class="mb-4">
                        <label for="rate_limit_ip_max_attempts" class="block text-sm font-medium text-gray-700 mb-1">
                            Số lần thử đăng nhập tối đa từ một IP
                        </label>
                        <div class="flex items-center space-x-2">
                            <input type="number" autocomplete="chrome-off"
                                min="10" 
                                max="100" 
                                step="1"
                                class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                                id="rate_limit_ip_max_attempts" 
                                name="rate_limit_ip_max_attempts" 
                                th:value="${rate_limit_ip_max_attempts ?: '20'}"
                                placeholder="20">
                            <span class="text-sm text-gray-500">lần (10-100)</span>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                            Giới hạn số lần thử đăng nhập từ một địa chỉ IP trong khoảng thời gian.
                        </p>
                    </div>

                    <div class="mb-4">
                        <label for="rate_limit_ip_window_minutes" class="block text-sm font-medium text-gray-700 mb-1">
                            Khoảng thời gian cho IP (phút)
                        </label>
                        <div class="flex items-center space-x-2">
                            <input type="number" autocomplete="chrome-off"
                                min="1" 
                                max="60" 
                                step="1"
                                class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                                id="rate_limit_ip_window_minutes" 
                                name="rate_limit_ip_window_minutes" 
                                th:value="${rate_limit_ip_window_minutes ?: '15'}"
                                placeholder="15">
                            <span class="text-sm text-gray-500">phút (1-60)</span>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                            Khoảng thời gian tính số lần thử đăng nhập từ một IP.
                        </p>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="text-md font-semibold text-gray-700 mb-3">Dọn dẹp dữ liệu</h4>
                    
                    <div class="mb-4">
                        <label for="rate_limit_cleanup_days" class="block text-sm font-medium text-gray-700 mb-1">
                            Số ngày giữ lại lịch sử đăng nhập
                        </label>
                        <div class="flex items-center space-x-2">
                            <input type="number" autocomplete="chrome-off"
                                min="7" 
                                max="365" 
                                step="1"
                                class="w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                                id="rate_limit_cleanup_days" 
                                name="rate_limit_cleanup_days" 
                                th:value="${rate_limit_cleanup_days ?: '30'}"
                                placeholder="30">
                            <span class="text-sm text-gray-500">ngày (7-365)</span>
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                            Các bản ghi đăng nhập cũ hơn số ngày này sẽ tự động bị xóa (chạy hàng ngày lúc 2h sáng).
                        </p>
                    </div>
                </div>
            </div>

            <!-- Tab: BẢO MẬT -->
            <div id="content-security" class="tab-content hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Cấu hình Bảo mật</h3>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-blue-800"><strong>Lưu ý:</strong> Thay đổi đường dẫn admin giúp ẩn trang quản trị khỏi các cuộc tấn công tự động. Sau khi thay đổi, bạn cần đăng nhập lại bằng đường dẫn mới.</p>
                </div>

                <div class="mb-6">
                    <h4 class="text-md font-semibold text-gray-700 mb-3">Đường dẫn Admin</h4>
                    
                    <div class="mb-4">
                        <label for="admin_path" class="block text-sm font-medium text-gray-700 mb-1">
                            Đường dẫn trang quản trị
                        </label>
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-500">/</span>
                            <input type="text" autocomplete="chrome-off"
                                pattern="[a-zA-Z0-9_-]+"
                                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                                id="admin_path" 
                                name="admin_path" 
                                th:value="${admin_path ?: 'admin'}"
                                placeholder="admin">
                        </div>
                        <p class="mt-1 text-xs text-gray-500">
                            Chỉ cho phép chữ cái, số, dấu gạch dưới (_) và dấu gạch ngang (-). Không được sử dụng các từ khóa: api, oauth2, login, static, uploads, nqt, favicon.ico
                        </p>
                        <p class="mt-1 text-xs text-yellow-600">
                            <strong>Cảnh báo:</strong> Sau khi thay đổi, đường dẫn hiện tại sẽ không còn hoạt động. Hãy ghi nhớ đường dẫn mới!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Tab: BANNER -->
            <div id="content-banner" class="tab-content hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Quản lý Banner Giới thiệu</h3>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <p class="text-sm text-blue-800"><strong>Hướng dẫn:</strong> Upload các ảnh để tạo banner carousel trên trang chủ.</p>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload ảnh banner mới</label>
                    <input type="file" name="bannerImages" accept="image/*" multiple autocomplete="chrome-off"
                        class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
                        id="bannerImagesInput"
                        onchange="previewBannerImages(this)">
                    <p class="mt-1 text-xs text-gray-500">Có thể chọn nhiều ảnh cùng lúc (Ctrl+Click hoặc Cmd+Click)</p>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Danh sách ảnh banner hiện tại</label>
                    <div id="bannerImagesList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <!-- Banner images will be displayed here -->
                        <div th:each="banner, iterStat : ${bannerImagesList}" 
                             class="relative group border border-gray-300 rounded-lg overflow-hidden bg-gray-50">
                            <img th:src="${banner}" alt="Banner" 
                                 class="w-full h-32 object-cover">
                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all flex items-center justify-center">
                                <button type="button" 
                                        onclick="removeBannerImage(this, '[[${banner}]]')"
                                        class="opacity-0 group-hover:opacity-100 bg-red-500 text-white px-3 py-1 rounded text-sm font-medium transition-all">
                                    Xóa
                                </button>
                            </div>
                            <div class="absolute top-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">
                                <span th:text="${iterStat.index + 1}">1</span>
                            </div>
                        </div>
                    </div>
                    <p th:if="${bannerImagesList == null or bannerImagesList.isEmpty()}" 
                       class="text-sm text-gray-500 mt-2">Chưa có ảnh banner nào. Hãy upload ảnh để bắt đầu.</p>
                </div>

                <!-- Hidden input to store banner images JSON -->
                <input type="hidden" name="bannerImagesJson" id="bannerImagesJson" 
                       th:value="${bannerImagesJson ?: '[]'}">
            </div>

            <div class="mt-6 pt-4 border-t">
                <button type="submit"
                    class="px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-sm transition-colors">
                    Lưu cấu hình
                </button>
            </div>
        </form>

        <script>
            // Tab navigation
            function showTab(tabName) {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Remove active state from all tabs
                document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                    tab.classList.remove('bg-white', 'text-gray-800', 'shadow-sm');
                    tab.classList.add('text-white', 'hover:bg-gray-600');
                });
                
                // Show selected tab content
                document.getElementById('content-' + tabName).classList.remove('hidden');
                
                // Add active state to selected tab
                const activeTab = document.getElementById('tab-' + tabName);
                activeTab.classList.remove('text-white', 'hover:bg-gray-600');
                activeTab.classList.add('bg-white', 'text-gray-800', 'shadow-sm');
            }
            
            // Initialize: show general tab by default
            document.addEventListener('DOMContentLoaded', function() {
                showTab('general');
                
                // Disable autocomplete for all form fields - multiple methods
                const form = document.querySelector('form[method="post"]');
                if (form) {
                    // Method 1: Set autocomplete off on form
                    form.setAttribute('autocomplete', 'off');
                    
                    // Method 2: Disable autocomplete for all inputs, selects, and textareas
                    const allInputs = form.querySelectorAll('input, select, textarea');
                    allInputs.forEach(function(field) {
                        // Skip hidden fields
                        if (field.type === 'hidden' || field.style.position === 'absolute') {
                            return;
                        }
                        
                        // Set autocomplete attribute
                        if (field.type === 'password') {
                            field.setAttribute('autocomplete', 'new-password');
                        } else if (field.type === 'email') {
                            field.setAttribute('autocomplete', 'chrome-off');
                        } else if (!field.getAttribute('autocomplete') || field.getAttribute('autocomplete') === 'off') {
                            field.setAttribute('autocomplete', 'chrome-off');
                        }
                        
                        // Method 3: Set readonly then remove it to prevent autofill
                        if (field.type !== 'file' && field.type !== 'color' && field.type !== 'hidden') {
                            const originalReadonly = field.readOnly;
                            field.readOnly = true;
                            setTimeout(function() {
                                field.readOnly = originalReadonly;
                            }, 100);
                        }
                        
                        // Method 4: Add data attribute to confuse browser
                        field.setAttribute('data-lpignore', 'true');
                        field.setAttribute('data-form-type', 'other');
                    });
                }
                
                // Method 5: Prevent autofill on focus
                document.addEventListener('focusin', function(e) {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                        if (e.target.type !== 'file' && e.target.type !== 'color') {
                            e.target.setAttribute('autocomplete', 'chrome-off');
                        }
                    }
                }, true);
            });
            function testSmtpConnection() {
                const resultDiv = document.getElementById('smtpTestResult');
                resultDiv.classList.remove('hidden');
                resultDiv.innerHTML = '<div class="bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded-lg">Đang kiểm tra kết nối SMTP...</div>';
                
                // Get form values
                const formData = new FormData();
                formData.append('nqtSmtpHost', document.getElementById('nqtSmtpHost').value);
                formData.append('nqtSmtpPort', document.getElementById('nqtSmtpPort').value);
                formData.append('nqtSmtpUsername', document.getElementById('nqtSmtpUsername').value);
                formData.append('nqtSmtpPassword', document.getElementById('nqtSmtpPassword').value || '');
                formData.append('nqtSmtpFromEmail', document.getElementById('nqtSmtpFromEmail').value);
                
                const adminPath = /*[[${nqtAdminPath}]]*/ '/admin';
                fetch(adminPath + '/setting/test-smtp', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        resultDiv.innerHTML = '<div class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg">✓ Kết nối SMTP thành công! ' + (data.message || '') + '</div>';
                    } else {
                        resultDiv.innerHTML = '<div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">✗ Lỗi: ' + (data.message || 'Không thể kết nối SMTP') + '</div>';
                    }
                })
                .catch(error => {
                    resultDiv.innerHTML = '<div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">✗ Lỗi: ' + error.message + '</div>';
                });
            }

            // Banner Images Management
            let bannerImagesArray = [];
            
            // Initialize banner images from hidden input
            document.addEventListener('DOMContentLoaded', function() {
                const bannerImagesJson = document.getElementById('bannerImagesJson');
                if (bannerImagesJson && bannerImagesJson.value) {
                    try {
                        bannerImagesArray = JSON.parse(bannerImagesJson.value);
                        updateBannerImagesList();
                    } catch (e) {
                        console.error('Error parsing banner images JSON:', e);
                    }
                }
            });

            function previewBannerImages(input) {
                if (input.files && input.files.length > 0) {
                    // Upload files first via AJAX
                    const formData = new FormData();
                    for (let i = 0; i < input.files.length; i++) {
                        formData.append('bannerImages', input.files[i]);
                    }
                    
                    // Get admin path from current URL or use model attribute
                    let adminPath = /*[[${nqtAdminPath}]]*/ '/admin';
                    // If model attribute is not available, extract from current URL
                    if (!adminPath || adminPath === '/admin') {
                        const currentPath = window.location.pathname;
                        // Extract admin path from current URL (e.g., /admin/setting -> /admin)
                        const match = currentPath.match(/^\/([^\/]+)/);
                        if (match) {
                            adminPath = '/' + match[1];
                        }
                    }
                    console.log('Using admin path:', adminPath);
                    fetch(adminPath + '/setting/upload-banner', {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json'
                        },
                        body: formData
                    })
                    .then(response => {
                        // Check if response is JSON
                        const contentType = response.headers.get('content-type');
                        if (!contentType || !contentType.includes('application/json')) {
                            return response.text().then(text => {
                                console.error('Non-JSON response:', text);
                                throw new Error('Server trả về dữ liệu không hợp lệ. Vui lòng thử lại.');
                            });
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success && data.images) {
                            // Add new images to array
                            data.images.forEach(img => {
                                if (!bannerImagesArray.includes(img)) {
                                    bannerImagesArray.push(img);
                                }
                            });
                            updateBannerImagesList();
                            // Clear input
                            input.value = '';
                        } else {
                            alert('Lỗi khi upload ảnh: ' + (data.message || 'Không thể upload'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Lỗi khi upload ảnh: ' + (error.message || 'Không thể kết nối đến server'));
                    });
                }
            }

            function removeBannerImage(button, imagePath) {
                if (confirm('Bạn có chắc muốn xóa ảnh này khỏi banner?')) {
                    bannerImagesArray = bannerImagesArray.filter(img => img !== imagePath);
                    updateBannerImagesList();
                }
            }

            function updateBannerImagesList() {
                const listDiv = document.getElementById('bannerImagesList');
                const hiddenInput = document.getElementById('bannerImagesJson');
                
                // Update hidden input
                hiddenInput.value = JSON.stringify(bannerImagesArray);
                
                // Update display
                if (bannerImagesArray.length === 0) {
                    listDiv.innerHTML = '<p class="text-sm text-gray-500 col-span-full">Chưa có ảnh banner nào. Hãy upload ảnh để bắt đầu.</p>';
                } else {
                    listDiv.innerHTML = bannerImagesArray.map((img, index) => `
                        <div class="relative group border border-gray-300 rounded-lg overflow-hidden bg-gray-50">
                            <img src="${img}" alt="Banner ${index + 1}" class="w-full h-32 object-cover">
                            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all flex items-center justify-center">
                                <button type="button" 
                                        onclick="removeBannerImage(this, '${img}')"
                                        class="opacity-0 group-hover:opacity-100 bg-red-500 text-white px-3 py-1 rounded text-sm font-medium transition-all">
                                    Xóa
                                </button>
                            </div>
                            <div class="absolute top-2 left-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded">
                                ${index + 1}
                            </div>
                        </div>
                    `).join('');
                }
            }
        </script>
    </div>
</body>

</html>